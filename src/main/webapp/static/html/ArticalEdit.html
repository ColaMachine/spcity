<script type="text/javascript" charset="utf-8" src="/spcity/static/js/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="/spcity/static/js/ueditor/ueditor.all.min.js"> </script>

<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="/spcity/static/js/ueditor/lang/zh-cn/zh-cn.js"></script>

<div class="modal-content">
    <form id="articalEditForm" class="form-horizontal" method="post" action="/artical/save.json" enctype="multipart/form-data">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title">新闻咨询编辑</h4>
        </div>
        <div class="modal-body">
                <input type="hidden" id="id" name="id"  class="form-control input-sm" >
    <div class="form-group">
        <label for="title" class="col-sm-2 control-label">标题:</label>
        <div class="col-sm-10">
            <input  type="text"  id="title" name="title"  class="form-control input-sm"   maxlength="40"></input>
        </div>
    </div>
    <div class="form-group">
        <label for="content" class="col-sm-2 control-label">正文:</label>
        <div class="col-sm-10">
            <script id="editor" type="text/plain" style="width:1024px;height:500px;"></script>
            <textarea style="display:none" id="content" name="content"  class="form-control input-sm"   maxlength="4000"></textarea>
        </div>
    </div>

    <div class="form-group">
        <label for="face" class="col-sm-2 control-label">封面:</label>
        <div class="col-sm-10">
            <input id="faceImgFileInput" type="file" style="display:none">
            <img class="row-10 img-upload" id="faceImg" style="width:150px;height:150px" src="static/img/timg.jpeg" alt="请上传封面">


            <input  id="pic" name="pic"  style="display:none" class="form-control input-sm"   maxlength="100"></input>
        </div>
    </div>
    <div class="form-group">
        <label for="type" class="col-sm-2 control-label">类型:</label>
        <div class="col-sm-10">
            <select  id="type" name="type"  class="form-control input-sm"  >
                <option value=''>-请选择-</option>
                <option value=1>新闻资讯</option>
           
            </select>
        </div>
    </div>
   <!-- <div class="form-group">
        <label for="status" class="col-sm-2 control-label">状态:</label>
        <div class="col-sm-10">
            <select  id="status" name="status"  class="form-control input-sm"  >
                <option value=''>-请选择-</option>
                <option value=1>新建</option>
                <option value=2>提交</option>
                <option value=3>审核通过</option>
                <option value=4>驳回</option>
                <option value=5>删除</option>
            </select>
        </div>
    </div>-->
    <div class="form-group">
        <label for="remark" class="col-sm-2 control-label">备注:</label>
        <div class="col-sm-10">
            <textarea  id="remark" name="remark"  class="form-control input-sm"   maxlength="200"></textarea>
        </div>
    </div>
    <!--<div class="form-group">
        <label for="createtime" class="col-sm-2 control-label">创建时间:</label>
        <div class="col-sm-10 z-col-table">
            <input type="text" id="createtime" name="createtime"  class="form-control input-sm"  onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"  datatype="date" format="yyyy-MM-dd HH:mm:ss"  ></input>
            <label class="input-group-addon" for="createtime" ><i class="fa fa-calendar"></i></label>        </div>
    </div>
    <div class="form-group">
        <label for="updatetime" class="col-sm-2 control-label">更新时间:</label>
        <div class="col-sm-10 z-col-table">
            <input type="text" id="updatetime" name="updatetime"  class="form-control input-sm"  onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"  datatype="date" format="yyyy-MM-dd HH:mm:ss"  ></input>
            <label class="input-group-addon" for="updatetime" ><i class="fa fa-calendar"></i></label>        </div>
    </div>

        </div>-->
        <div class="modal-footer">
            <button type="button"  class="btn btn-primarys saveBtn">保存</button>
            <button type="button" class="btn btn-default cancelBtn">取消</button>
        </div>
    </form>
</div><!-- /.modal-content -->

<script type="text/javascript">
 var ue = UE.getEditor('editor');
var articalEdit={
    form:null,
    modal:false,
    formId:"#articalEditForm",
    validParam:{
        rules: {
                   id:{
            digits:true
        },
        title:{
            maxlength:40,required:true
        },
        content:{
            maxlength:4000,required:true
        },
        type:{
            CheckBox:["1","2","3"],digits:true,required:true
        },
        status:{
            CheckBox:["1","2","3","4","5"],digits:true
        },
        remark:{
            maxlength:200
        },
        createtime:{
            ymd:"yyyy-MM-dd HH:mm:ss"
        },
        updatetime:{
            ymd:"yyyy-MM-dd HH:mm:ss"
        },

        },
        messages:{
                   id:{
            digits:"必须输入整数"
        },
        title:{
            maxlength:"title不能多于40个字符"
        },
        content:{
            maxlength:"content不能多于4000个字符"
        },
        type:{
            CheckBox:"必须输入'1','2','3'中的值",digits:"必须输入整数"
        },
        status:{
            CheckBox:"必须输入'1','2','3','4','5'中的值",digits:"必须输入整数"
        },
        remark:{
            maxlength:"remark不能多于200个字符"
        },
        createtime:{
            ymd:"必须输入合法日期"
        },
        updatetime:{
            ymd:"必须输入合法日期"
        },

        }
    },
    addEventListener:function(){
        this.form.find(".saveBtn").click(this.saveInfo);
        this.form.find(".cancelBtn").click(this.cancel);
    },
    init:function(){
        this.form=$(this.formId);
        this.addEventListener();
        $("#articalEditForm").validate(this.validParam);
         var imageUtil= new zImageUtil({imgDom:$("#faceImg")[0],fileInput:$("#faceImgFileInput")[0],postUrl:PATH+"/image/upload.json",maxWidth:633,maxHeight:300,
        callback:function(result){
        console.log("callback");
                    console.log(result.data);

                    $("#pic").val(result.data);

                }
        });
        Ajax.getJSON("artical/view.json?id="+getParam("id"),null,function(data){
            if(data.r==AJAX_SUCC){
            if(data.data.bean){
                fillJso2Form("#articalEditForm",data.data.bean);

                ue.setContent(data.data.bean.content);

                 if(!StringUtil.isBlank(data.data.bean.pic))
                $("#faceImg").attr("src",PATH+"/"+data.data.bean.pic)
            }
            }else{
                dialog.error("获取信息失败"+data.msg,function(index){
                    goPage("artical/list.htm");
                   dialog.close(index);
                });
            }
        });
    },
    saveInfo:function(){
    $("#content").val(UE.getEditor('editor').getContent());
    var count = UE.getEditor('editor').getContentLength(true);

/**  if(UE.getEditor('editor').getContent().length>2000){
    dialog.alert("你输入的字符个数"+UE.getEditor('editor').getContent().length+ "已经超出最大允许值！");
    return;
    }**/
        if (!$("#articalEditForm").valid())
            return;
        var jso = changeForm2Jso("#articalEditForm");
        var dialogId=dialog.showWait();

        var that=this;
        Ajax.post(PATH+$("#articalEditForm").attr("action"),jso,function(data){
            dialog.hideWait(dialogId);
            if(data.r==0){
                dialog.alert(data.msg||"保存成功",function(index){
                    //goPage("artical/list.htm");
                     articalEdit.cancel();
                    if(this.modal){
                        $("#articalGrid").jqGrid("reloadGrid");
                    }
                     dialog.close(index);
                });
            }else{
                dialog.error(data.msg);
            }
        },'json');
    },
    cancel:function(){
        if(this.modal){
                $("#mymodal").modal("toggle");
        }else{
            goPage("artical/list.htm");
        }
    }
}
$(document).ready(function() {
    //获取传入参数
    ue.addListener("ready", function () {
// editor准备好之后才可以使用
 articalEdit.init();

});

});
</script>
